<!doctype html>
<html lang="en">
  <head>
    <title>CS4241 Assignment 2</title>
    <meta charset="utf-8">
  </head>
  <body>
    <table id="orders">
    </table>
    <form action="">
      <!-- Fulfill order menu -->
      <input type="number" id="orderNum" placeholder="Order number">
      <button id="fulfill">Fulfill</button>
    </form>
  <br>
  <form action="">
    <!-- Order Form -->
    <select id="color">
      <option value="Blue">Blue</option>
      <option value = "Red">Red</option>
      <option value = "Green">Green</option>
    </select>
    <input type="number" id="quantity" placeholder="Quantity">
    <button id="order">Buy now</button>
  </form>
  </body>
  <script>

  const submitOrder = function( e ) {
    // prevent default form action from being carried out
    e.preventDefault()

    const color = document.getElementById( 'color' ),
            quantity = document.getElementById('quantity'),
          json = {type: "order", color: color.value, quantity: quantity.value},
          body = JSON.stringify( json );
    console.log("Submitting order");

    fetch( '/submit', {
      method:'POST',
      body 
    })
    .then( function( response ) {
      // do something with the response
      return response.text();
    }).then( function(txt) {
      let appdata = JSON.parse(txt);
      let table = document.getElementById('orders');
      table.innerHTML = "";
      let thead = table.createTHead();
      let row = thead.insertRow();
      for (let key of Object.keys(appdata[0])) {
        let th = document.createElement("th");
        let text = document.createTextNode(key);
        th.appendChild(text);
        row.appendChild(th);
      }
      for (let element of appdata) {
        let row = table.insertRow();
        for (let key in element) {
          let cell = row.insertCell();
          let text = document.createTextNode(element[key]);
          cell.appendChild(text);
        }
      }
      return false;
    })

    return false
  };

  const fulfillOrder = function(e) {
    // prevent default form action from being carried out
    e.preventDefault()

    const orderNum = document.getElementById( 'orderNum' ),
            json = {type: "fulfill", orderNum: orderNum.value},
            body = JSON.stringify( json );

    fetch( '/submit', {
      method:'POST',
      body
    })
            .then( function( response ) {
              // do something with the response
              return response.text();
            }).then( function(txt) {
              let appdata = JSON.parse(txt);
              let table = document.getElementById('orders');
              table.innerHTML = "";
              let thead = table.createTHead();
              let row = thead.insertRow();
            for (let key of Object.keys(appdata[0])) {
              let th = document.createElement("th");
              let text = document.createTextNode(key);
              th.appendChild(text);
              row.appendChild(th);
            }
            for (let element of appdata) {
              let row = table.insertRow();
              for (let key in element) {
                let cell = row.insertCell();
                let text = document.createTextNode(element[key]);
                cell.appendChild(text);
              }
            }
            return false;
    })

    return false
  };

  window.onload = function() {
    const orderButton = document.getElementById( 'order' );
            const fulfillButton = document.getElementById('fulfill');
            fulfillButton.onclick = fulfillOrder;
            orderButton.onclick = submitOrder;
  }

  </script>
</html>
